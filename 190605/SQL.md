##  SQL 

###    내가 속한 각 부서 별로 월급 평균 이상으로 받는 직원들을 조회 하시오



```   sql
SELECT ENAME,SAL FROM EMP e1
WHERE SAL > (
SELECT AVG(SAL)FROM EMP e2
WHERE e1.DEPTNO =e2.DEPTNO
GROUP BY DEPTNO
)


```

###  내가 속한 각 부서 별로 월급 가장 많이받 는 직원들을 조회 하시오

``` sql
SELECT e1.DEPTNO,e1.ENAME,e1.SAL,d.DNAME,d.LOC FROM EMP e1,DEPT d
WHERE e1.DEPTNO = d.DEPTNO
AND SAL >= (
SELECT MAX(SAL)FROM EMP e2
WHERE e1.DEPTNO =e2.DEPTNO
GROUP BY DEPTNO
)
```

###  DALLAS에 있는 직원의 정보를 조회 하시오

``` sql
SELECT e1.DEPTNO,e1.ENAME,e1.SAL,d.DNAME,d.LOC FROM EMP e1,DEPT d
WHERE e1.DEPTNO = d.DEPTNO
AND  e1.DEPTNO IN (
SELECT DEPTNO FROM DEPT 
WHERE  LOC ='DALLAS'
)
```

EXIST = EXIST 안에 문장이 TRUE면 호출 해라 

``` sql
SELECT e1.DEPTNO,e1.ENAME,e1.SAL,d.DNAME,d.LOC FROM EMP e1,DEPT d
WHERE e1.DEPTNO = d.DEPTNO
AND  EXISTS (
SELECT d2.DEPTNO FROM DEPT d2,EMP e2
WHERE d2.DEPTNO = e2.DEPTNO
AND LOC ='DALLAS'
AND e1.DEPTNO =e2.DEPTNO
)

```

###      JONE가 속한 JOB의 직원을 조회 하시오 

```sql
SELECT ENAME,JOB FROM EMP
WHERE JOB IN(
SELECT JOB FROM EMP
WHERE ENAME ='JONES'
)

```

###  EXISTS 쓰시오 

```sql
SELECT ENAME,JOB FROM EMP e1
WHERE EXISTS(
SELECT JOB FROM EMP e2
WHERE ENAME ='JONES'
AND e1.JOB = e2.JOB
)
```

##   집합연산

   JONE가 속한 JOB의 직원을 조회 하시오 . 단 직원의 부서명과 지역을 출력하시오

```sql
SELECT e1.ENAME,e1.JOB,d.DEPTNO,d.LOC  FROM EMP e1, DEPT d

WHERE EXISTS(
SELECT JOB FROM EMP e2
WHERE ENAME ='JONES'
AND e1.JOB = e2.JOB
)

```

MANAGER 와 SALES 직원들의 이름과 JOB을 조회 하시오 

```sql
SELECT ENAME,JOB FROM EMP
WHERE JOB ='MANAGER'
UNION
SELECT ENAME,JOB FROM EMP
WHERE JOB ='SALESMAN'
ORDER BY JOB
```

###  UNION

```sql
SELECT ENAME,JOB FROM EMP
WHERE JOB ='MANAGER'
UNION
SELECT ENAME,TO_CHAR(HIREDATE,'YYYY/MM/DD') FROM EMP
WHERE JOB ='SALESMAN'
ORDER BY JOB
```

###  INNER JOIN

```sql
SELECT e.ENAME,d.LOC FROM
EMP e,DEPT d
WHERE e.DEPTNO = d.DEPTNO --오라클 전용 
AND e.JOB='MANAGER'           
AND d.LOC='CHICAGO'

SELECT e.ENAME,d.LOC FROM --PK랑
EMP e INNER JOIN DEPT d
ON (e.DEPTNO = d.DEPTNO) 
WHERE e.JOB='MANAGER'           
AND d.LOC='CHICAGO'


```

직원 정보를 조회 하시오 ENO,ENM,SAL,ASAL,DNM.LOC

```sql
CREATE VIEW T_EMP
FROM (
 SELECT EMPNO, ENAME,SAL,DEPTNO FROM EMP
)
CREATE VIEW T_EMP(ENO,ENM,SAL,DNO)
AS (
 SELECT EMPNO, ENAME,SAL,DEPTNO FROM EMP
)
CREATE VIEW T_DEPT(DNO,DNM,LOC)
AS(
SELECT DEPTNO,DNAME,LOC FROM DEPT
) 
SELECT e.ENO, e.ENM, e.SAL, a.ASL, d.DNM, d.LOC 
FROM T_EMP e,T_SAL a,T_DEPT d
WHERE e.DNO = d.DNO
AND e.ENO=a.ENO
AND a.ASL > (
SELECT  AVG(S1.ASL)
FROM T_EMP e1,T_SAL s1
WHERE e1.ENO = S1.ENO
AND e.DNO = e1.DNO
GROUP BY (e1.DNO)
)
```

###  SELF JOIN

``` sql
SELECT e1.EMPNO AS EMPNO,
       e1.ENAME AS ENAME,
       e2.ENAME AS MNAME                          
FROM EMP e1,EMP e2
WHERE e1.MGR = e2.EMPNO
```



OUTER JOIN 

```sql
SELECT e.ENAME,e.JOB,d.DNAME,d.LOC
FROM EMP e,DEPT d
WHERE e.DEPTNO = d.DEPTNO(+)

--ANTI 기준--
SELECT e.ENAME,e.JOB,d.DNAME,d.LOC
FROM EMP e LEFT OUTER JOIN DEPT d USING(DEPTNO)

SELECT e.ENAME,e.JOB,d.DNAME,d.LOC
FROM EMP e FULL OUTER JOIN DEPT d USING(DEPTNO)

```

###  RANK   순차적으로  순위를 만들수 있다. 

```sql
SELECT ENAME, SAL,
ROW_NUMBER() OVER (ORDER BY SAL DESC) AS ROW_NUM
FROM EMP
--5위 안에 사람을 보고 싶다.--
SELECT ENAME,SAL,ROW_NUM FROM(
      SELECT ENAME, SAL,
      ROW_NUMBER() OVER (ORDER BY SAL DESC) AS ROW_NUM
      FROM EMP
)
WHERE ROW_NUM <=5

--서브 쿼리을 써서 TOTAL과 ASAL을 구하자-
SELECT ENAME,SAL,
ROUND((SELECT AVG(SAL)FROM EMP),2)AS ASAL,
RANK, 
(SELECT COUNT(*)FROM EMP)AS TOTAL
FROM(
      SELECT ENAME, SAL,
      RANK() OVER (ORDER BY SAL DESC) AS RANK
      FROM EMP
)
WHERE RANK <=5

```

###  ROLLUP

````sql
SELECT JOB,ROUND(AVG(SAL),2), SUM(SAL) FROM EMP
GROUP BY ROLLUP(JOB)

````



